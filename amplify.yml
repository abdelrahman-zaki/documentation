version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - npm run build
    postBuild:
      commands:
        - echo "Send Slack notification"
        - |
          curl -H 'Content-Type: application/json' -X POST --data '{
            "blocks": [
              {
                "type": "header",
                "text": {
                  "text": ":rocket:  New deployment",
                  "type": "plain_text",
                  "emoji": true
                }
              },
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn",
                  "text": ":globe_with_meridians:  <https://docs.kinde.com|View site>"
                }
              },
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn",
                  "text": ":github:  <https://github.com/kinde-oss/documentation/commit/'"$AWS_COMMIT_ID"'|View changes>"
                }
              }
            ]
          }' $SLACK_KINDE_DOCS_PR_WEBHOOK_URL
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/* 